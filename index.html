<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <meta name="theme-color" content="#ffffff">
  <link rel="icon" type="image/png" sizes="32x32"
    href="https://smart-contact-cdn.livelanding.it/images/favicon-{{ account }}.png">
  <title>{{ pageTitle }}</title>
  <style>
    .grecaptcha-badge {
      display: none;
    }
  </style>

  <!-- @{{ GoogleGlobalSiteTag }} -->
  <!-- @{{ GoogleAdsDataLayerPageView }} -->
  <!-- @{{ GoogleTagManagerHead }} -->
  <!-- @{{ pixelCode }} -->
  <!-- @{{ privacyModalScript }} -->
  <!-- @{{ cookiebotScript }} -->
</head>

<body>
  <!-- @{{ GoogleTagManagerBody }} -->

  <div id="app"></div>

  <script>
    const activityHandlers = {
      dem(landing) {
        let sourceName = landing.params.get('f5');
        landing.params.set('f12', Date.now().toString());

        switch (landing.params.get('f15')) {
          case 'chebuoni':
          case 'chebuonipilot':
            landing.params.set('f11', landing.url.searchParams.get('aff_id') || '-');
            landing.params.set('f12', landing.url.searchParams.get('source') || '-');
            landing.params.set('f13', landing.url.searchParams.get('transaction_id') || '-');
            landing.params.set('f14', landing.url.searchParams.get('id') || '-');
            break;
          case 'bunkerads':
            const transaction_id = Date.now().toString();
            landing.params.set('f11', landing.url.searchParams.get('aff_id') || '-');
            break;
        }
      }
    };
    window.$landingConfig = {
      config: {
        params() {
          return {
            //functional
            // collection: { value: '{{ collection }}', default: '' },
            products: { value: '{{ products }}', parser: value => JSON.parse('[' + value + ']') },
            sap: '{{ sap }}',
            useFo: { value: '{{ useFo }}', default: '0', parser: value => !!Number(value) },
            useHeaderScroll: { value: '{{ useHeaderScroll }}', default: '1', parser: value => !!Number(value) },
            successURL: '{{ successURL }}',
            collapseToggleText: '{{ collapseToggleText }}',
            useRecaptcha: { value: '{{ useRecaptcha }}', default: "0", parser: value => !!Number(value) },
            account: '{{ account }}',
            logoAccount: '{{ accountLogo }}',
            logoAccountMobile: '{{ accountLogoMobile }}',

            //copy
            copyTitle: `{{ copyTitle }}`,
            copySubtitle: `{{ copySubtitle }}`,
            copyFooter: `{{ copyFooter }}`,

            //privacy
            "*privacy_1": `{{ privacy_1 }}`,
            "&privacy_2": `{{ privacy_2 }}`,
            "&privacy_3": `{{ privacy_3 }}`,
            "&privacy_4": `{{ privacy_4 }}`,

            //tracking
            gclid: { value: this.url.searchParams.get('gclid') || '-', default: '-' },
            f4: { value: this.url.searchParams.get('f4') || '{{ f4 }}', default: '' },
            f5: { value: this.url.searchParams.get('f5') || '{{ f5 }}', default: 'dem' },
            f11: { value: this.url.searchParams.get('f11') || '{{ f11 }}', default: '0' },
            f12: { value: this.url.searchParams.get('keyword') || '0' },
            f13: { value: this.url.searchParams.get('matchtype') || '0' },
            f14: { value: this.url.searchParams.get('creative') || '0' },
            f15: { value: this.url.searchParams.get('f15') || '{{ f15 }}', default: '0' },
            f18: { value: this.url.searchParams.get('f18') || '{{ f18 }}', default: '0' }
          }
        },

        data() {
          return {
            url_landing: location.origin + location.pathname,
            name: '-',
            surname: '-',
            offer: '{{ defaultOffer }}',
          }
        },

        injection: {
          sourceOptions: {
            id: '{{ smartBridgeSourceID }}'
          }
        }
      },
      options: {},
      afterInit(landing) {
        activityHandlers[landing.params.get('f5')](landing);
        landing.mapParamsToData(['gclid as idorigine', 'sap', 'f5', 'f11', 'f12', 'f13', 'f14', 'f15', 'f18']);
        if (landing.params.get('useFo')) {
          landing.scheduleBetween('21:00:00', '09:00:00', () => {
            landing.data.set('sap', landing.params.get('sap') + '_fo');
            landing.params.set('useCtc', 0);
          });
        }

        setSuccessURLParams(landing);
      }
    };


    function setSuccessURLParams(landing) {
      if (landing.params.get('successURL')) {
        const url = new URL(landing.params.get('successURL'), location.origin);
        const urlParams = Object.fromEntries(new URLSearchParams(location.href.split('?')[1]));
        //inserire qui la mappatura dei parametri della landing sull'url
        const paramsMap = {
          f4: landing.params.get('f4'),
          f5: landing.params.get('f5'),
          f11: landing.params.get('f11'),
          f12: landing.params.get('f12'),
          f13: landing.params.get('f13'),
          f14: landing.params.get('f14'),
          f15: landing.params.get('f15'),
          f18: landing.params.get('f18'),
          pixelId: landing.params.get('f12')
        };
        Object.entries(urlParams).forEach(([key, value]) => {
          if (!paramsMap.hasOwnProperty(key) && value !== undefined && value !== '') {
            paramsMap[key] = value;
          }
        });
        Object.entries(paramsMap).forEach(([key, value]) => {
          if (value !== undefined && value !== '') {
            url.searchParams.append(key, value);
          }
        });

        landing.params.set('successURL', url.toString());
      }
    }
  </script>

  <script type="module" src="/src/main.js"></script>
  <!-- @{{ privacyModalElement }} -->
</body>

</html>